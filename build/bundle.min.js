!function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a="function"==typeof require&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}for(var i="function"==typeof require&&require,o=0;o<r.length;o++)s(r[o]);return s}({1:[function(){THREE.VRControls=function(t,s){function n(t){i=t,t.length>0?e=t[0]:s&&s("VR input not available.")}var e,i,o=this,a=new THREE.Matrix4,r=null;"VRFrameData"in window&&(r=new VRFrameData),navigator.getVRDisplays&&navigator.getVRDisplays().then(n)["catch"](function(){console.warn("THREE.VRControls: Unable to get VR Displays")}),this.scale=1,this.standing=!1,this.userHeight=1.6,this.getVRDisplay=function(){return e},this.setVRDisplay=function(t){e=t},this.getVRDisplays=function(){return console.warn("THREE.VRControls: getVRDisplays() is being deprecated."),i},this.getStandingMatrix=function(){return a},this.update=function(){if(e){var s;e.getFrameData?(e.getFrameData(r),s=r.pose):e.getPose&&(s=e.getPose()),null!==s.orientation&&t.quaternion.fromArray(s.orientation),null!==s.position?t.position.fromArray(s.position):t.position.set(0,0,0),this.standing&&(e.stageParameters?(t.updateMatrix(),a.fromArray(e.stageParameters.sittingToStandingTransform),t.applyMatrix(a)):t.position.setY(t.position.y+this.userHeight)),t.position.multiplyScalar(o.scale)}},this.resetPose=function(){e&&e.resetPose()},this.resetSensor=function(){console.warn("THREE.VRControls: .resetSensor() is now .resetPose()."),this.resetPose()},this.zeroSensor=function(){console.warn("THREE.VRControls: .zeroSensor() is now .resetPose()."),this.resetPose()},this.dispose=function(){e=null}}},{}],2:[function(){THREE.VREffect=function(e,t){function i(e){h=e,e.length>0?o=e[0]:t&&t("HMD not available")}function r(){var t=f.isPresenting;if(f.isPresenting=void 0!==o&&o.isPresenting,f.isPresenting){var i=o.getEyeParameters("left"),r=i.renderWidth,n=i.renderHeight;t||(p=e.getPixelRatio(),w=e.getSize(),e.setPixelRatio(1),e.setSize(2*r,n,!1))}else t&&(e.setPixelRatio(p),e.setSize(w.width,w.height,m))}function n(e){var t=2/(e.leftTan+e.rightTan),i=(e.leftTan-e.rightTan)*t*.5,r=2/(e.upTan+e.downTan),n=(e.upTan-e.downTan)*r*.5;return{scale:[t,r],offset:[i,n]}}function a(e,t,i,r){t=void 0===t||t,i=void 0===i?.01:i,r=void 0===r?1e4:r;var a=t?-1:1,s=new THREE.Matrix4,o=s.elements,h=n(e);return o[0]=h.scale[0],o[1]=0,o[2]=h.offset[0]*a,o[3]=0,o[4]=0,o[5]=h.scale[1],o[6]=-h.offset[1]*a,o[7]=0,o[8]=0,o[9]=0,o[10]=r/(i-r)*-a,o[11]=r*i/(i-r),o[12]=0,o[13]=0,o[14]=a,o[15]=0,s.transpose(),s}function s(e,t,i,r){var n=Math.PI/180,s={upTan:Math.tan(e.upDegrees*n),downTan:Math.tan(e.downDegrees*n),leftTan:Math.tan(e.leftDegrees*n),rightTan:Math.tan(e.rightDegrees*n)};return a(s,t,i,r)}var o,h,d,l,u=new THREE.Vector3,g=new THREE.Vector3,c=null;"VRFrameData"in window&&(c=new window.VRFrameData),navigator.getVRDisplays&&navigator.getVRDisplays().then(i)["catch"](function(){console.warn("THREE.VREffect: Unable to get VR Displays")}),this.isPresenting=!1,this.scale=1;var f=this,w=e.getSize(),m=!1,p=e.getPixelRatio();this.getVRDisplay=function(){return o},this.setVRDisplay=function(e){o=e},this.getVRDisplays=function(){return console.warn("THREE.VREffect: getVRDisplays() is being deprecated."),h},this.setSize=function(t,i,r){if(w={width:t,height:i},m=r,f.isPresenting){var n=o.getEyeParameters("left");e.setPixelRatio(1),e.setSize(2*n.renderWidth,n.renderHeight,!1)}else e.setPixelRatio(p),e.setSize(t,i,r)};var v=e.domElement,y=[0,0,.5,1],R=[.5,0,.5,1];window.addEventListener("vrdisplaypresentchange",r,!1),this.setFullScreen=function(e){return new Promise(function(t,i){return void 0===o?void i(new Error("No VR hardware found.")):f.isPresenting===e?void t():void t(e?o.requestPresent([{source:v}]):o.exitPresent())})},this.requestPresent=function(){return this.setFullScreen(!0)},this.exitPresent=function(){return this.setFullScreen(!1)},this.requestAnimationFrame=function(e){return void 0!==o?o.requestAnimationFrame(e):window.requestAnimationFrame(e)},this.cancelAnimationFrame=function(e){void 0!==o?o.cancelAnimationFrame(e):window.cancelAnimationFrame(e)},this.submitFrame=function(){void 0!==o&&f.isPresenting&&o.submitFrame()},this.autoSubmitFrame=!0;var x=new THREE.PerspectiveCamera;x.layers.enable(1);var E=new THREE.PerspectiveCamera;E.layers.enable(2),this.render=function(t,i,r,n){if(o&&f.isPresenting){var a=t.autoUpdate;a&&(t.updateMatrixWorld(),t.autoUpdate=!1);var h=o.getEyeParameters("left"),w=o.getEyeParameters("right");u.fromArray(h.offset),g.fromArray(w.offset),Array.isArray(t)&&(console.warn("THREE.VREffect.render() no longer supports arrays. Use object.layers instead."),t=t[0]);var m,p,v=e.getSize(),P=o.getLayers();if(P.length){var T=P[0];m=null!==T.leftBounds&&4===T.leftBounds.length?T.leftBounds:y,p=null!==T.rightBounds&&4===T.rightBounds.length?T.rightBounds:R}else m=y,p=R;d={x:Math.round(v.width*m[0]),y:Math.round(v.height*m[1]),width:Math.round(v.width*m[2]),height:Math.round(v.height*m[3])},l={x:Math.round(v.width*p[0]),y:Math.round(v.height*p[1]),width:Math.round(v.width*p[2]),height:Math.round(v.height*p[3])},r?(e.setRenderTarget(r),r.scissorTest=!0):(e.setRenderTarget(null),e.setScissorTest(!0)),(e.autoClear||n)&&e.clear(),null===i.parent&&i.updateMatrixWorld(),i.matrixWorld.decompose(x.position,x.quaternion,x.scale),i.matrixWorld.decompose(E.position,E.quaternion,E.scale);var M=this.scale;return x.translateOnAxis(u,M),E.translateOnAxis(g,M),o.getFrameData?(o.depthNear=i.near,o.depthFar=i.far,o.getFrameData(c),x.projectionMatrix.elements=c.leftProjectionMatrix,E.projectionMatrix.elements=c.rightProjectionMatrix):(x.projectionMatrix=s(h.fieldOfView,!0,i.near,i.far),E.projectionMatrix=s(w.fieldOfView,!0,i.near,i.far)),r?(r.viewport.set(d.x,d.y,d.width,d.height),r.scissor.set(d.x,d.y,d.width,d.height)):(e.setViewport(d.x,d.y,d.width,d.height),e.setScissor(d.x,d.y,d.width,d.height)),e.render(t,x,r,n),r?(r.viewport.set(l.x,l.y,l.width,l.height),r.scissor.set(l.x,l.y,l.width,l.height)):(e.setViewport(l.x,l.y,l.width,l.height),e.setScissor(l.x,l.y,l.width,l.height)),e.render(t,E,r,n),r?(r.viewport.set(0,0,v.width,v.height),r.scissor.set(0,0,v.width,v.height),r.scissorTest=!1,e.setRenderTarget(null)):(e.setViewport(0,0,v.width,v.height),e.setScissorTest(!1)),a&&(t.autoUpdate=!0),void(f.autoSubmitFrame&&f.submitFrame())}e.render(t,i,r,n)},this.dispose=function(){window.removeEventListener("vrdisplaypresentchange",r,!1)}}},{}],3:[function(){THREE.OBJLoader=function(e){this.manager=void 0!==e?e:THREE.DefaultLoadingManager,this.materials=null,this.regexp={vertex_pattern:/^v\s+([\d|\.|\+|\-|e|E]+)\s+([\d|\.|\+|\-|e|E]+)\s+([\d|\.|\+|\-|e|E]+)/,normal_pattern:/^vn\s+([\d|\.|\+|\-|e|E]+)\s+([\d|\.|\+|\-|e|E]+)\s+([\d|\.|\+|\-|e|E]+)/,uv_pattern:/^vt\s+([\d|\.|\+|\-|e|E]+)\s+([\d|\.|\+|\-|e|E]+)/,face_vertex:/^f\s+(-?\d+)\s+(-?\d+)\s+(-?\d+)(?:\s+(-?\d+))?/,face_vertex_uv:/^f\s+(-?\d+)\/(-?\d+)\s+(-?\d+)\/(-?\d+)\s+(-?\d+)\/(-?\d+)(?:\s+(-?\d+)\/(-?\d+))?/,face_vertex_uv_normal:/^f\s+(-?\d+)\/(-?\d+)\/(-?\d+)\s+(-?\d+)\/(-?\d+)\/(-?\d+)\s+(-?\d+)\/(-?\d+)\/(-?\d+)(?:\s+(-?\d+)\/(-?\d+)\/(-?\d+))?/,face_vertex_normal:/^f\s+(-?\d+)\/\/(-?\d+)\s+(-?\d+)\/\/(-?\d+)\s+(-?\d+)\/\/(-?\d+)(?:\s+(-?\d+)\/\/(-?\d+))?/,object_pattern:/^[og]\s*(.+)?/,smoothing_pattern:/^s\s+(\d+|on|off)/,material_library_pattern:/^mtllib /,material_use_pattern:/^usemtl /}},THREE.OBJLoader.prototype={constructor:THREE.OBJLoader,load:function(e,t,r,a){var i=this,s=new THREE.FileLoader(i.manager);s.setPath(this.path),s.load(e,function(e){t(i.parse(e))},r,a)},setPath:function(e){this.path=e},setMaterials:function(e){this.materials=e},_createParserState:function(){var e={objects:[],object:{},vertices:[],normals:[],uvs:[],materialLibraries:[],startObject:function(e,t){if(this.object&&this.object.fromDeclaration===!1)return this.object.name=e,void(this.object.fromDeclaration=t!==!1);var r=this.object&&"function"==typeof this.object.currentMaterial?this.object.currentMaterial():void 0;if(this.object&&"function"==typeof this.object._finalize&&this.object._finalize(!0),this.object={name:e||"",fromDeclaration:t!==!1,geometry:{vertices:[],normals:[],uvs:[]},materials:[],smooth:!0,startMaterial:function(e,t){var r=this._finalize(!1);r&&(r.inherited||r.groupCount<=0)&&this.materials.splice(r.index,1);var a={index:this.materials.length,name:e||"",mtllib:Array.isArray(t)&&t.length>0?t[t.length-1]:"",smooth:void 0!==r?r.smooth:this.smooth,groupStart:void 0!==r?r.groupEnd:0,groupEnd:-1,groupCount:-1,inherited:!1,clone:function(e){var t={index:"number"==typeof e?e:this.index,name:this.name,mtllib:this.mtllib,smooth:this.smooth,groupStart:0,groupEnd:-1,groupCount:-1,inherited:!1};return t.clone=this.clone.bind(t),t}};return this.materials.push(a),a},currentMaterial:function(){return this.materials.length>0?this.materials[this.materials.length-1]:void 0},_finalize:function(e){var t=this.currentMaterial();if(t&&-1===t.groupEnd&&(t.groupEnd=this.geometry.vertices.length/3,t.groupCount=t.groupEnd-t.groupStart,t.inherited=!1),e&&this.materials.length>1)for(var r=this.materials.length-1;r>=0;r--)this.materials[r].groupCount<=0&&this.materials.splice(r,1);return e&&0===this.materials.length&&this.materials.push({name:"",smooth:this.smooth}),t}},r&&r.name&&"function"==typeof r.clone){var a=r.clone(0);a.inherited=!0,this.object.materials.push(a)}this.objects.push(this.object)},finalize:function(){this.object&&"function"==typeof this.object._finalize&&this.object._finalize(!0)},parseVertexIndex:function(e,t){var r=parseInt(e,10);return 3*(r>=0?r-1:r+t/3)},parseNormalIndex:function(e,t){var r=parseInt(e,10);return 3*(r>=0?r-1:r+t/3)},parseUVIndex:function(e,t){var r=parseInt(e,10);return 2*(r>=0?r-1:r+t/2)},addVertex:function(e,t,r){var a=this.vertices,i=this.object.geometry.vertices;i.push(a[e+0]),i.push(a[e+1]),i.push(a[e+2]),i.push(a[t+0]),i.push(a[t+1]),i.push(a[t+2]),i.push(a[r+0]),i.push(a[r+1]),i.push(a[r+2])},addVertexLine:function(e){var t=this.vertices,r=this.object.geometry.vertices;r.push(t[e+0]),r.push(t[e+1]),r.push(t[e+2])},addNormal:function(e,t,r){var a=this.normals,i=this.object.geometry.normals;i.push(a[e+0]),i.push(a[e+1]),i.push(a[e+2]),i.push(a[t+0]),i.push(a[t+1]),i.push(a[t+2]),i.push(a[r+0]),i.push(a[r+1]),i.push(a[r+2])},addUV:function(e,t,r){var a=this.uvs,i=this.object.geometry.uvs;i.push(a[e+0]),i.push(a[e+1]),i.push(a[t+0]),i.push(a[t+1]),i.push(a[r+0]),i.push(a[r+1])},addUVLine:function(e){var t=this.uvs,r=this.object.geometry.uvs;r.push(t[e+0]),r.push(t[e+1])},addFace:function(e,t,r,a,i,s,n,o,h,l,d,u){var p,c=this.vertices.length,m=this.parseVertexIndex(e,c),f=this.parseVertexIndex(t,c),v=this.parseVertexIndex(r,c);if(void 0===a?this.addVertex(m,f,v):(p=this.parseVertexIndex(a,c),this.addVertex(m,f,p),this.addVertex(f,v,p)),void 0!==i){var g=this.uvs.length;m=this.parseUVIndex(i,g),f=this.parseUVIndex(s,g),v=this.parseUVIndex(n,g),void 0===a?this.addUV(m,f,v):(p=this.parseUVIndex(o,g),this.addUV(m,f,p),this.addUV(f,v,p))}if(void 0!==h){var x=this.normals.length;m=this.parseNormalIndex(h,x),f=h===l?m:this.parseNormalIndex(l,x),v=h===d?m:this.parseNormalIndex(d,x),void 0===a?this.addNormal(m,f,v):(p=this.parseNormalIndex(u,x),this.addNormal(m,f,p),this.addNormal(f,v,p))}},addLineGeometry:function(e,t){this.object.geometry.type="Line";for(var r=this.vertices.length,a=this.uvs.length,i=0,s=e.length;s>i;i++)this.addVertexLine(this.parseVertexIndex(e[i],r));for(var n=0,s=t.length;s>n;n++)this.addUVLine(this.parseUVIndex(t[n],a))}};return e.startObject("",!1),e},parse:function(e){console.time("OBJLoader");var t=this._createParserState();-1!==e.indexOf("\r\n")&&(e=e.replace(/\r\n/g,"\n")),-1!==e.indexOf("\\\n")&&(e=e.replace(/\\\n/g,""));for(var r=e.split("\n"),a="",i="",s="",n=0,o=[],h="function"==typeof"".trimLeft,l=0,d=r.length;d>l;l++)if(a=r[l],a=h?a.trimLeft():a.trim(),n=a.length,0!==n&&(i=a.charAt(0),"#"!==i))if("v"===i)if(s=a.charAt(1)," "===s&&null!==(o=this.regexp.vertex_pattern.exec(a)))t.vertices.push(parseFloat(o[1]),parseFloat(o[2]),parseFloat(o[3]));else if("n"===s&&null!==(o=this.regexp.normal_pattern.exec(a)))t.normals.push(parseFloat(o[1]),parseFloat(o[2]),parseFloat(o[3]));else{if("t"!==s||null===(o=this.regexp.uv_pattern.exec(a)))throw new Error("Unexpected vertex/normal/uv line: '"+a+"'");t.uvs.push(parseFloat(o[1]),parseFloat(o[2]))}else if("f"===i)if(null!==(o=this.regexp.face_vertex_uv_normal.exec(a)))t.addFace(o[1],o[4],o[7],o[10],o[2],o[5],o[8],o[11],o[3],o[6],o[9],o[12]);else if(null!==(o=this.regexp.face_vertex_uv.exec(a)))t.addFace(o[1],o[3],o[5],o[7],o[2],o[4],o[6],o[8]);else if(null!==(o=this.regexp.face_vertex_normal.exec(a)))t.addFace(o[1],o[3],o[5],o[7],void 0,void 0,void 0,void 0,o[2],o[4],o[6],o[8]);else{if(null===(o=this.regexp.face_vertex.exec(a)))throw new Error("Unexpected face line: '"+a+"'");t.addFace(o[1],o[2],o[3],o[4])}else if("l"===i){var u=a.substring(1).trim().split(" "),p=[],c=[];if(-1===a.indexOf("/"))p=u;else for(var m=0,f=u.length;f>m;m++){var v=u[m].split("/");""!==v[0]&&p.push(v[0]),""!==v[1]&&c.push(v[1])}t.addLineGeometry(p,c)}else if(null!==(o=this.regexp.object_pattern.exec(a))){var g=(" "+o[0].substr(1).trim()).substr(1);t.startObject(g)}else if(this.regexp.material_use_pattern.test(a))t.object.startMaterial(a.substring(7).trim(),t.materialLibraries);else if(this.regexp.material_library_pattern.test(a))t.materialLibraries.push(a.substring(7).trim());else{if(null===(o=this.regexp.smoothing_pattern.exec(a))){if("\x00"===a)continue;throw new Error("Unexpected line: '"+a+"'")}var x=o[1].trim().toLowerCase();t.object.smooth="1"===x||"on"===x;var b=t.object.currentMaterial();b&&(b.smooth=t.object.smooth)}t.finalize();var E=new THREE.Group;E.materialLibraries=[].concat(t.materialLibraries);for(var l=0,d=t.objects.length;d>l;l++){var _=t.objects[l],j=_.geometry,y=_.materials,L="Line"===j.type;if(0!==j.vertices.length){var V=new THREE.BufferGeometry;V.addAttribute("position",new THREE.BufferAttribute(new Float32Array(j.vertices),3)),j.normals.length>0?V.addAttribute("normal",new THREE.BufferAttribute(new Float32Array(j.normals),3)):V.computeVertexNormals(),j.uvs.length>0&&V.addAttribute("uv",new THREE.BufferAttribute(new Float32Array(j.uvs),2));for(var w=[],H=0,R=y.length;R>H;H++){var T=y[H],b=void 0;if(null!==this.materials&&(b=this.materials.create(T.name),L&&b&&!(b instanceof THREE.LineBasicMaterial))){var I=new THREE.LineBasicMaterial;I.copy(b),b=I}b||(b=L?new THREE.LineBasicMaterial:new THREE.MeshPhongMaterial,b.name=T.name),b.shading=T.smooth?THREE.SmoothShading:THREE.FlatShading,w.push(b)}var F;if(w.length>1){for(var H=0,R=y.length;R>H;H++){var T=y[H];V.addGroup(T.groupStart,T.groupCount,H)}var M=new THREE.MultiMaterial(w);F=L?new THREE.LineSegments(V,M):new THREE.Mesh(V,M)}else F=L?new THREE.LineSegments(V,w[0]):new THREE.Mesh(V,w[0]);F.name=_.name,E.add(F)}}return console.timeEnd("OBJLoader"),E}}},{}],4:[function(){THREE.ViveController=function(t){function e(t){for(var e=navigator.getGamepads(),i=0,r=0;4>i;i++){var n=e[i];if(n&&"OpenVR Gamepad"===n.id){if(r===t)return n;r++}}}THREE.Object3D.call(this);var i,r=this,n=[0,0],s=!1,o=!1,a=!1,p=!1;this.matrixAutoUpdate=!1,this.standingMatrix=new THREE.Matrix4,this.getGamepad=function(){return i},this.getButtonState=function(t){return"thumbpad"===t?s:"trigger"===t?o:"grips"===t?a:"menu"===t?p:void 0},this.update=function(){if(i=e(t),void 0!==i&&void 0!==i.pose){if(null===i.pose)return;var u=i.pose;null!==u.position&&r.position.fromArray(u.position),null!==u.orientation&&r.quaternion.fromArray(u.orientation),r.matrix.compose(r.position,r.quaternion,r.scale),r.matrix.multiplyMatrices(r.standingMatrix,r.matrix),r.matrixWorldNeedsUpdate=!0,r.visible=!0,n[0]===i.axes[0]&&n[1]===i.axes[1]||(n[0]=i.axes[0],n[1]=i.axes[1],r.dispatchEvent({type:"axischanged",axes:n})),s!==i.buttons[0].pressed&&(s=i.buttons[0].pressed,r.dispatchEvent({type:s?"thumbpaddown":"thumbpadup"})),o!==i.buttons[1].pressed&&(o=i.buttons[1].pressed,r.dispatchEvent({type:o?"triggerdown":"triggerup"})),a!==i.buttons[2].pressed&&(a=i.buttons[2].pressed,r.dispatchEvent({type:a?"gripsdown":"gripsup"})),p!==i.buttons[3].pressed&&(p=i.buttons[3].pressed,r.dispatchEvent({type:p?"menudown":"menuup"}))}else r.visible=!1}},THREE.ViveController.prototype=Object.create(THREE.Object3D.prototype),THREE.ViveController.prototype.constructor=THREE.ViveController},{}],5:[function(require,module,exports){(function(global){!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var t;t="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,t.WebVRManager=e()}}(function(){return function e(t,i,n){function o(r,a){if(!i[r]){if(!t[r]){var c="function"==typeof require&&require;if(!a&&c)return c(r,!0);if(s)return s(r,!0);var l=new Error("Cannot find module '"+r+"'");throw l.code="MODULE_NOT_FOUND",l}var u=i[r]={exports:{}};t[r][0].call(u.exports,function(e){var i=t[r][1][e];return o(i?i:e)},u,u.exports,e,t,i,n)}return i[r].exports}for(var s="function"==typeof require&&require,r=0;r<n.length;r++)o(n[r]);return o}({1:[function(e,t){function n(e){var t=e||document.body;this.loadIcons_();var i=this.createButton();i.src=this.ICONS.fullscreen,i.title="Fullscreen mode";var n=i.style;n.bottom=0,n.right=0,i.addEventListener("click",this.createClickHandler_("fs")),t.appendChild(i),this.fsButton=i;var o=this.createButton();o.src=this.ICONS.cardboard,o.title="Virtual reality mode";var n=o.style;n.bottom=0,n.right="48px",o.addEventListener("click",this.createClickHandler_("vr")),t.appendChild(o),this.vrButton=o,this.isVisible=!0}var o=e("./emitter.js"),s=e("./modes.js"),r=e("./util.js");n.prototype=new o,n.prototype.createButton=function(){var e=document.createElement("img");e.className="webvr-button";var t=e.style;return t.position="absolute",t.width="24px",t.height="24px",t.backgroundSize="cover",t.backgroundColor="transparent",t.border=0,t.userSelect="none",t.webkitUserSelect="none",t.MozUserSelect="none",t.cursor="pointer",t.padding="12px",t.zIndex=1,t.display="none",t.boxSizing="content-box",e.draggable=!1,e.addEventListener("dragstart",function(e){e.preventDefault()}),e.addEventListener("mouseenter",function(){t.filter=t.webkitFilter="drop-shadow(0 0 5px rgba(255,255,255,1))"}),e.addEventListener("mouseleave",function(){t.filter=t.webkitFilter=""}),e},n.prototype.setMode=function(e,t){if(t=t||WebVRConfig.FORCE_ENABLE_VR,this.isVisible){switch(e){case s.NORMAL:this.fsButton.style.display="block",this.fsButton.src=this.ICONS.fullscreen,this.vrButton.style.display=t?"block":"none";break;case s.MAGIC_WINDOW:this.fsButton.style.display="block",this.fsButton.src=this.ICONS.exitFullscreen,this.vrButton.style.display="none";break;case s.VR:this.fsButton.style.display="none",this.vrButton.style.display="none"}var i=this.fsButton.style.display;this.fsButton.style.display="inline-block",this.fsButton.offsetHeight,this.fsButton.style.display=i}},n.prototype.setVisibility=function(e){this.isVisible=e,this.fsButton.style.display=e?"block":"none",this.vrButton.style.display=e?"block":"none"},n.prototype.createClickHandler_=function(e){return function(t){t.stopPropagation(),t.preventDefault(),this.emit(e)}.bind(this)},n.prototype.loadIcons_=function(){this.ICONS={},this.ICONS.cardboard=r.base64("image/svg+xml","PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNHB4IiBoZWlnaHQ9IjI0cHgiIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0iI0ZGRkZGRiI+CiAgICA8cGF0aCBkPSJNMjAuNzQgNkgzLjIxQzIuNTUgNiAyIDYuNTcgMiA3LjI4djEwLjQ0YzAgLjcuNTUgMS4yOCAxLjIzIDEuMjhoNC43OWMuNTIgMCAuOTYtLjMzIDEuMTQtLjc5bDEuNC0zLjQ4Yy4yMy0uNTkuNzktMS4wMSAxLjQ0LTEuMDFzMS4yMS40MiAxLjQ1IDEuMDFsMS4zOSAzLjQ4Yy4xOS40Ni42My43OSAxLjExLjc5aDQuNzljLjcxIDAgMS4yNi0uNTcgMS4yNi0xLjI4VjcuMjhjMC0uNy0uNTUtMS4yOC0xLjI2LTEuMjh6TTcuNSAxNC42MmMtMS4xNyAwLTIuMTMtLjk1LTIuMTMtMi4xMiAwLTEuMTcuOTYtMi4xMyAyLjEzLTIuMTMgMS4xOCAwIDIuMTIuOTYgMi4xMiAyLjEzcy0uOTUgMi4xMi0yLjEyIDIuMTJ6bTkgMGMtMS4xNyAwLTIuMTMtLjk1LTIuMTMtMi4xMiAwLTEuMTcuOTYtMi4xMyAyLjEzLTIuMTNzMi4xMi45NiAyLjEyIDIuMTMtLjk1IDIuMTItMi4xMiAyLjEyeiIvPgogICAgPHBhdGggZmlsbD0ibm9uZSIgZD0iTTAgMGgyNHYyNEgwVjB6Ii8+Cjwvc3ZnPgo="),this.ICONS.fullscreen=r.base64("image/svg+xml","PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNHB4IiBoZWlnaHQ9IjI0cHgiIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0iI0ZGRkZGRiI+CiAgICA8cGF0aCBkPSJNMCAwaDI0djI0SDB6IiBmaWxsPSJub25lIi8+CiAgICA8cGF0aCBkPSJNNyAxNEg1djVoNXYtMkg3di0zem0tMi00aDJWN2gzVjVINXY1em0xMiA3aC0zdjJoNXYtNWgtMnYzek0xNCA1djJoM3YzaDJWNWgtNXoiLz4KPC9zdmc+Cg=="),this.ICONS.exitFullscreen=r.base64("image/svg+xml","PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNHB4IiBoZWlnaHQ9IjI0cHgiIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0iI0ZGRkZGRiI+CiAgICA8cGF0aCBkPSJNMCAwaDI0djI0SDB6IiBmaWxsPSJub25lIi8+CiAgICA8cGF0aCBkPSJNNSAxNmgzdjNoMnYtNUg1djJ6bTMtOEg1djJoNVY1SDh2M3ptNiAxMWgydi0zaDN2LTJoLTV2NXptMi0xMVY1aC0ydjVoNVY4aC0zeiIvPgo8L3N2Zz4K"),this.ICONS.settings=r.base64("image/svg+xml","PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNHB4IiBoZWlnaHQ9IjI0cHgiIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0iI0ZGRkZGRiI+CiAgICA8cGF0aCBkPSJNMCAwaDI0djI0SDB6IiBmaWxsPSJub25lIi8+CiAgICA8cGF0aCBkPSJNMTkuNDMgMTIuOThjLjA0LS4zMi4wNy0uNjQuMDctLjk4cy0uMDMtLjY2LS4wNy0uOThsMi4xMS0xLjY1Yy4xOS0uMTUuMjQtLjQyLjEyLS42NGwtMi0zLjQ2Yy0uMTItLjIyLS4zOS0uMy0uNjEtLjIybC0yLjQ5IDFjLS41Mi0uNC0xLjA4LS43My0xLjY5LS45OGwtLjM4LTIuNjVDMTQuNDYgMi4xOCAxNC4yNSAyIDE0IDJoLTRjLS4yNSAwLS40Ni4xOC0uNDkuNDJsLS4zOCAyLjY1Yy0uNjEuMjUtMS4xNy41OS0xLjY5Ljk4bC0yLjQ5LTFjLS4yMy0uMDktLjQ5IDAtLjYxLjIybC0yIDMuNDZjLS4xMy4yMi0uMDcuNDkuMTIuNjRsMi4xMSAxLjY1Yy0uMDQuMzItLjA3LjY1LS4wNy45OHMuMDMuNjYuMDcuOThsLTIuMTEgMS42NWMtLjE5LjE1LS4yNC40Mi0uMTIuNjRsMiAzLjQ2Yy4xMi4yMi4zOS4zLjYxLjIybDIuNDktMWMuNTIuNCAxLjA4LjczIDEuNjkuOThsLjM4IDIuNjVjLjAzLjI0LjI0LjQyLjQ5LjQyaDRjLjI1IDAgLjQ2LS4xOC40OS0uNDJsLjM4LTIuNjVjLjYxLS4yNSAxLjE3LS41OSAxLjY5LS45OGwyLjQ5IDFjLjIzLjA5LjQ5IDAgLjYxLS4yMmwyLTMuNDZjLjEyLS4yMi4wNy0uNDktLjEyLS42NGwtMi4xMS0xLjY1ek0xMiAxNS41Yy0xLjkzIDAtMy41LTEuNTctMy41LTMuNXMxLjU3LTMuNSAzLjUtMy41IDMuNSAxLjU3IDMuNSAzLjUtMS41NyAzLjUtMy41IDMuNXoiLz4KPC9zdmc+Cg==")},t.exports=n},{"./emitter.js":2,"./modes.js":3,"./util.js":4}],2:[function(e,t){function n(){this.callbacks={}}n.prototype.emit=function(e){var t=this.callbacks[e];if(t){var i=[].slice.call(arguments);i.shift();for(var n=0;n<t.length;n++)t[n].apply(this,i)}},n.prototype.on=function(e,t){e in this.callbacks?this.callbacks[e].push(t):this.callbacks[e]=[t]},t.exports=n},{}],3:[function(e,t){var n={UNKNOWN:0,NORMAL:1,MAGIC_WINDOW:2,VR:3};t.exports=n},{}],4:[function(e,t){var n={};n.base64=function(e,t){return"data:"+e+";base64,"+t},n.isMobile=function(){var e=!1;return function(t){(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(t)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(t.substr(0,4)))&&(e=!0)}(navigator.userAgent||navigator.vendor||window.opera),e},n.isFirefox=function(){return/firefox/i.test(navigator.userAgent)},n.isIOS=function(){return/(iPad|iPhone|iPod)/g.test(navigator.userAgent)},n.isIFrame=function(){try{return window.self!==window.top}catch(e){return!0}},n.appendQueryParameter=function(e,t,i){var n=e.indexOf("?")<0?"?":"&";return e+=n+t+"="+i},n.getQueryParameter=function(e){var e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]"),t=new RegExp("[\\?&]"+e+"=([^&#]*)"),i=t.exec(location.search);return null===i?"":decodeURIComponent(i[1].replace(/\+/g," "))},n.isLandscapeMode=function(){return 90==window.orientation||-90==window.orientation},n.getScreenWidth=function(){return Math.max(window.screen.width,window.screen.height)*window.devicePixelRatio},n.getScreenHeight=function(){return Math.min(window.screen.width,window.screen.height)*window.devicePixelRatio},t.exports=n},{}],5:[function(e,t){function n(e,t,i){this.params=i||{},this.mode=r.UNKNOWN,this.hideButton=this.params.hideButton||!1,this.predistorted=!!this.params.predistorted,this.renderer=e,this.effect=t;var n=document.querySelector(".webvr-polyfill-fullscreen-wrapper");this.button=new o(n),this.isFullscreenDisabled=!!a.getQueryParameter("no_fullscreen"),this.startMode=r.NORMAL;var s=parseInt(a.getQueryParameter("start_mode"));isNaN(s)||(this.startMode=s),this.hideButton&&this.button.setVisibility(!1),this.getDeviceByType_(VRDisplay).then(function(e){switch(this.hmd=e,this.isVRCompatibleOverride||(this.isVRCompatible=!e.isPolyfilled||a.isMobile()),this.startMode){case r.MAGIC_WINDOW:this.setMode_(r.MAGIC_WINDOW);break;case r.VR:this.enterVRMode_(),this.setMode_(r.VR);break;default:this.setMode_(r.NORMAL)}this.emit("initialized")}.bind(this)),this.button.on("fs",this.onFSClick_.bind(this)),this.button.on("vr",this.onVRClick_.bind(this)),document.addEventListener("webkitfullscreenchange",this.onFullscreenChange_.bind(this)),document.addEventListener("mozfullscreenchange",this.onFullscreenChange_.bind(this)),document.addEventListener("msfullscreenchange",this.onFullscreenChange_.bind(this)),window.addEventListener("vrdisplaypresentchange",this.onVRDisplayPresentChange_.bind(this)),window.addEventListener("vrdisplaydeviceparamschange",this.onVRDisplayDeviceParamsChange_.bind(this))}var o=e("./button-manager.js"),s=e("./emitter.js"),r=e("./modes.js"),a=e("./util.js");n.prototype=new s,n.Modes=r,n.prototype.render=function(e,t){e instanceof Array?this.effect.render(e[0],t):this.effect.render(e,t)},n.prototype.setVRCompatibleOverride=function(e){this.isVRCompatible=e,this.isVRCompatibleOverride=!0,this.button.setMode(this.mode,this.isVRCompatible)},n.prototype.setFullscreenCallback=function(e){this.fullscreenCallback=e},n.prototype.setVRCallback=function(e){this.vrCallback=e},n.prototype.setExitFullscreenCallback=function(e){this.exitFullscreenCallback=e},n.prototype.getDeviceByType_=function(e){return new Promise(function(t){navigator.getVRDisplays().then(function(i){for(var n=0;n<i.length;n++)if(i[n]instanceof e){t(i[n]);break}t(null)},function(){t(null)})})},n.prototype.enterVRMode_=function(){this.hmd.requestPresent([{source:this.renderer.domElement,predistorted:this.predistorted}])},n.prototype.setMode_=function(e){var t=this.mode;return e==this.mode?void console.warn("Not changing modes, already in %s",e):(this.mode=e,this.button.setMode(e,this.isVRCompatible),void this.emit("modechange",e,t))},n.prototype.onFSClick_=function(){switch(this.mode){case r.NORMAL:if(a.isIOS()&&a.isIFrame()){if(!this.fullscreenCallback){var e=window.location.href;return e=a.appendQueryParameter(e,"no_fullscreen","true"),e=a.appendQueryParameter(e,"start_mode",r.MAGIC_WINDOW),void(top.location.href=e)}this.fullscreenCallback()}this.setMode_(r.MAGIC_WINDOW),this.requestFullscreen_();break;case r.MAGIC_WINDOW:if(this.isFullscreenDisabled)return void window.history.back();this.exitFullscreenCallback&&this.exitFullscreenCallback(),this.setMode_(r.NORMAL),this.exitFullscreen_()}},n.prototype.onVRClick_=function(){if(this.mode==r.NORMAL&&a.isIOS()&&a.isIFrame()){if(!this.vrCallback){var e=window.location.href;return e=a.appendQueryParameter(e,"no_fullscreen","true"),e=a.appendQueryParameter(e,"start_mode",r.VR),void(top.location.href=e)}this.vrCallback()}this.enterVRMode_()},n.prototype.requestFullscreen_=function(){var e=document.body;e.requestFullscreen?e.requestFullscreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.webkitRequestFullscreen?e.webkitRequestFullscreen():e.msRequestFullscreen&&e.msRequestFullscreen()},n.prototype.exitFullscreen_=function(){document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.msExitFullscreen&&document.msExitFullscreen()},n.prototype.onVRDisplayPresentChange_=function(e){console.log("onVRDisplayPresentChange_",e),this.setMode_(this.hmd.isPresenting?r.VR:r.NORMAL)},n.prototype.onVRDisplayDeviceParamsChange_=function(e){console.log("onVRDisplayDeviceParamsChange_",e)},n.prototype.onFullscreenChange_=function(){null!==document.webkitFullscreenElement&&null!==document.mozFullScreenElement||this.setMode_(r.NORMAL)},t.exports=n},{"./button-manager.js":1,"./emitter.js":2,"./modes.js":3,"./util.js":4}]},{},[5])(5)})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],6:[function(){!function(t){"use strict";function e(t){if("string"!=typeof t&&(t=String(t)),/[^a-z0-9\-#$%&'*+.\^_`|~]/i.test(t))throw new TypeError("Invalid character in header field name");return t.toLowerCase()}function r(t){return"string"!=typeof t&&(t=String(t)),t}function o(t){var e={next:function(){var e=t.shift();return{done:void 0===e,value:e}}};return m.iterable&&(e[Symbol.iterator]=function(){return e}),e}function n(t){this.map={},t instanceof n?t.forEach(function(t,e){this.append(e,t)},this):t&&Object.getOwnPropertyNames(t).forEach(function(e){this.append(e,t[e])},this)}function i(t){return t.bodyUsed?Promise.reject(new TypeError("Already read")):void(t.bodyUsed=!0)}function s(t){return new Promise(function(e,r){t.onload=function(){e(t.result)},t.onerror=function(){r(t.error)}})}function a(t){var e=new FileReader,r=s(e);return e.readAsArrayBuffer(t),r}function u(t){var e=new FileReader,r=s(e);return e.readAsText(t),r}function h(t){for(var e=new Uint8Array(t),r=new Array(e.length),o=0;o<e.length;o++)r[o]=String.fromCharCode(e[o]);return r.join("")}function f(t){if(t.slice)return t.slice(0);var e=new Uint8Array(t.byteLength);return e.set(new Uint8Array(t)),e.buffer}function d(){return this.bodyUsed=!1,this._initBody=function(t){if(this._bodyInit=t,t)if("string"==typeof t)this._bodyText=t;else if(m.blob&&Blob.prototype.isPrototypeOf(t))this._bodyBlob=t;else if(m.formData&&FormData.prototype.isPrototypeOf(t))this._bodyFormData=t;else if(m.searchParams&&URLSearchParams.prototype.isPrototypeOf(t))this._bodyText=t.toString();else if(m.arrayBuffer&&m.blob&&v(t))this._bodyArrayBuffer=f(t.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer]);else{if(!m.arrayBuffer||!ArrayBuffer.prototype.isPrototypeOf(t)&&!B(t))throw new Error("unsupported BodyInit type");

this._bodyArrayBuffer=f(t)}else this._bodyText="";this.headers.get("content-type")||("string"==typeof t?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):m.searchParams&&URLSearchParams.prototype.isPrototypeOf(t)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},m.blob&&(this.blob=function(){var t=i(this);if(t)return t;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){return this._bodyArrayBuffer?i(this)||Promise.resolve(this._bodyArrayBuffer):this.blob().then(a)}),this.text=function(){var t=i(this);if(t)return t;if(this._bodyBlob)return u(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(h(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},m.formData&&(this.formData=function(){return this.text().then(p)}),this.json=function(){return this.text().then(JSON.parse)},this}function y(t){var e=t.toUpperCase();return _.indexOf(e)>-1?e:t}function l(t,e){e=e||{};var r=e.body;if("string"==typeof t)this.url=t;else{if(t.bodyUsed)throw new TypeError("Already read");this.url=t.url,this.credentials=t.credentials,e.headers||(this.headers=new n(t.headers)),this.method=t.method,this.mode=t.mode,r||null==t._bodyInit||(r=t._bodyInit,t.bodyUsed=!0)}if(this.credentials=e.credentials||this.credentials||"omit",!e.headers&&this.headers||(this.headers=new n(e.headers)),this.method=y(e.method||this.method||"GET"),this.mode=e.mode||this.mode||null,this.referrer=null,("GET"===this.method||"HEAD"===this.method)&&r)throw new TypeError("Body not allowed for GET or HEAD requests");this._initBody(r)}function p(t){var e=new FormData;return t.trim().split("&").forEach(function(t){if(t){var r=t.split("="),o=r.shift().replace(/\+/g," "),n=r.join("=").replace(/\+/g," ");e.append(decodeURIComponent(o),decodeURIComponent(n))}}),e}function c(t){var e=new n;return t.split("\r\n").forEach(function(t){var r=t.split(":"),o=r.shift().trim();if(o){var n=r.join(":").trim();e.append(o,n)}}),e}function b(t,e){e||(e={}),this.type="default",this.status="status"in e?e.status:200,this.ok=this.status>=200&&this.status<300,this.statusText="statusText"in e?e.statusText:"OK",this.headers=new n(e.headers),this.url=e.url||"",this._initBody(t)}if(!t.fetch){var m={searchParams:"URLSearchParams"in t,iterable:"Symbol"in t&&"iterator"in Symbol,blob:"FileReader"in t&&"Blob"in t&&function(){try{return new Blob,!0}catch(t){return!1}}(),formData:"FormData"in t,arrayBuffer:"ArrayBuffer"in t};if(m.arrayBuffer)var w=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],v=function(t){return t&&DataView.prototype.isPrototypeOf(t)},B=ArrayBuffer.isView||function(t){return t&&w.indexOf(Object.prototype.toString.call(t))>-1};n.prototype.append=function(t,o){t=e(t),o=r(o);var n=this.map[t];this.map[t]=n?n+","+o:o},n.prototype["delete"]=function(t){delete this.map[e(t)]},n.prototype.get=function(t){return t=e(t),this.has(t)?this.map[t]:null},n.prototype.has=function(t){return this.map.hasOwnProperty(e(t))},n.prototype.set=function(t,o){this.map[e(t)]=r(o)},n.prototype.forEach=function(t,e){for(var r in this.map)this.map.hasOwnProperty(r)&&t.call(e,this.map[r],r,this)},n.prototype.keys=function(){var t=[];return this.forEach(function(e,r){t.push(r)}),o(t)},n.prototype.values=function(){var t=[];return this.forEach(function(e){t.push(e)}),o(t)},n.prototype.entries=function(){var t=[];return this.forEach(function(e,r){t.push([r,e])}),o(t)},m.iterable&&(n.prototype[Symbol.iterator]=n.prototype.entries);var _=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];l.prototype.clone=function(){return new l(this,{body:this._bodyInit})},d.call(l.prototype),d.call(b.prototype),b.prototype.clone=function(){return new b(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new n(this.headers),url:this.url})},b.error=function(){var t=new b(null,{status:0,statusText:""});return t.type="error",t};var A=[301,302,303,307,308];b.redirect=function(t,e){if(-1===A.indexOf(e))throw new RangeError("Invalid status code");return new b(null,{status:e,headers:{location:t}})},t.Headers=n,t.Request=l,t.Response=b,t.fetch=function(t,e){return new Promise(function(r,o){var n=new l(t,e),i=new XMLHttpRequest;i.onload=function(){var t={status:i.status,statusText:i.statusText,headers:c(i.getAllResponseHeaders()||"")};t.url="responseURL"in i?i.responseURL:t.headers.get("X-Request-URL");var e="response"in i?i.response:i.responseText;r(new b(e,t))},i.onerror=function(){o(new TypeError("Network request failed"))},i.ontimeout=function(){o(new TypeError("Network request failed"))},i.open(n.method,n.url,!0),"include"===n.credentials&&(i.withCredentials=!0),"responseType"in i&&m.blob&&(i.responseType="blob"),n.headers.forEach(function(t,e){i.setRequestHeader(e,t)}),i.send("undefined"==typeof n._bodyInit?null:n._bodyInit)})},t.fetch.polyfill=!0}}("undefined"!=typeof self?self:this)},{}],7:[function(require,module,exports){(function(global){"use strict";function _interopRequireWildcard(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t["default"]=e,t}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(exports,"__esModule",{value:!0});var _three="undefined"!=typeof window?window.THREE:"undefined"!=typeof global?global.THREE:null,THREE=_interopRequireWildcard(_three),Fire=function(e){function t(){_classCallCheck(this,t);var n=_possibleConstructorReturn(this,e.call(this));n.numParticles=1e3,n.opts={sparkLifecycle:.7,sparkStartSize:10,sparkEndSize:20,sparkDistanceScale:1.5,flameMinHeight:.02,flameMaxHeight:.25,flamePeriod:.5,windStrength:.14,windFrequency:.5,color:16565832,endColor:12604956,opacity:.7,gravity:.2,baseWidth:.8};var i=new THREE.TextureLoader;return i.load("https://s3-us-west-2.amazonaws.com/s.cdpn.io/126747/snowflake_16x16.png",function(e){n.texture=e,n.system.material.uniforms.texture.value=e}),n}return _inherits(t,e),t.prototype.init=function(){var e=new THREE.Vector3;e.copy(this.up).applyQuaternion(this.getWorldQuaternion().inverse());for(var t=new THREE.BufferGeometry,n=new THREE.ShaderMaterial({uniforms:{up:{type:"v3",value:e},gravity:{type:"f",value:this.opts.gravity},elapsedTime:{type:"f",value:0},numParticles:{type:"f",value:this.numParticles},color:{type:"c",value:new THREE.Color(this.opts.color)},endColor:{type:"c",value:new THREE.Color(this.opts.endColor)},flameMaxHeight:{type:"f",value:this.opts.flameMaxHeight},flameMinHeight:{type:"f",value:this.opts.flameMinHeight},flamePeriod:{type:"f",value:this.opts.flamePeriod},windStrength:{type:"f",value:this.opts.windStrength},windFrequency:{type:"f",value:this.opts.windFrequency},sparkLifecycle:{type:"f",value:this.opts.sparkLifecycle},sparkDistanceScale:{type:"f",value:this.opts.sparkDistanceScale},sparkStartSize:{type:"f",value:this.opts.sparkStartSize},sparkEndSize:{type:"f",value:this.opts.sparkEndSize},opacity:{type:"f",value:this.opts.opacity},texture:{type:"t",value:null}},transparent:!0,depthTest:!1,vertexShader:'\n        uniform float elapsedTime;\n        uniform float numParticles;\n        uniform float gravity;\n        uniform vec3 up;\n\n        uniform float sparkLifecycle;\n        uniform float sparkDistanceScale;\n        uniform float sparkStartSize;\n        uniform float sparkEndSize;\n\n        uniform float flameMaxHeight;\n        uniform float flameMinHeight;\n        uniform float flamePeriod;\n        uniform float windStrength;\n        uniform float windFrequency;\n\n        attribute vec3 direction;\n        attribute float uniqueness;\n        attribute float particleIndex;\n\n        #define PI 3.141592653589793238462643383279\n\n        varying float vTime;\n\n        void main( void ) {\n          // unique duration\n          float duration = sparkLifecycle + sparkLifecycle * uniqueness;\n\n          // make time loop\n          float particleOffset = (particleIndex / numParticles * duration);\n          float time = mod(elapsedTime + particleOffset, duration);\n\n          // store time as 0-1 for fragment shader\n          vTime = time / duration;\n\n          // apply "gravity" to fire\n          vec3 vGravity = up * gravity * pow(vTime, 2.0);\n\n          // move in direction based on elapsed time\n          float flameHeight = mix(flameMinHeight, flameMaxHeight, uniqueness);\n          vec3 vDistance = flameHeight * direction * vTime;\n\n          // close flame at top (0.5 is fully closed)\n          vDistance.xz *= cos(mix(0.0, PI * flamePeriod, vTime));\n\n          // apply some random horizonal wind\n          vec3 vWind = sin((elapsedTime + vTime * uniqueness) * windFrequency * uniqueness) * cross(up, direction) * windStrength * uniqueness * vTime;\n\n          // add all forces to get final position for this frame\n          vec3 pos = position + vDistance + vGravity + vWind;\n\n          // Set size based on frame and distance\n          vec4 mvPosition = modelViewMatrix * vec4( pos, 1.0 );\n          gl_PointSize = mix(sparkStartSize, sparkEndSize, vTime);\n          gl_PointSize = gl_PointSize * (sparkDistanceScale / length(mvPosition.xyz));\n\n          // project position on screen\n          gl_Position = projectionMatrix * modelViewMatrix * vec4(pos, 1.0);\n        }\n\n      ',fragmentShader:"\n        uniform vec3 color;\n        uniform vec3 endColor;\n        uniform float opacity;\n        uniform sampler2D texture;\n\n        varying float vTime;\n\n        void main() {\n          vec4 texColor = texture2D(texture, gl_PointCoord);\n          vec4 startColor = vec4(color, opacity);\n          vec4 endColor = vec4(endColor, 0.0);\n          gl_FragColor = texColor * mix(startColor, endColor, vTime);\n        }\n      "}),i=new Float32Array(3*this.numParticles),r=0;r<i.length;r+=3)i[r]=0;for(var o=new Float32Array(3*this.numParticles),a=0;a<o.length;a+=3){var s=this.randCenter(Math.PI*this.opts.baseWidth),l=this.randCenter(Math.PI),u=THREE.Spherical(1,s,l),p=new THREE.Vector3;p.setFromSpherical(u),o[a]=p.x,o[a+1]=p.y,o[a+2]=p.z}for(var f=new Float32Array(this.numParticles),c=0;c<this.numParticles;c++)f[c]=Math.random();for(var d=new Float32Array(this.numParticles),m=0;m<this.numParticles;m++)d[m]=m;t.addAttribute("position",new THREE.BufferAttribute(i,3)),t.addAttribute("direction",new THREE.BufferAttribute(o,3)),t.addAttribute("uniqueness",new THREE.BufferAttribute(f,1)),t.addAttribute("particleIndex",new THREE.BufferAttribute(d,1)),t.computeBoundingSphere(),this.system=new THREE.Points(t,n),this.add(this.system),this.system.renderOrder=2},t.prototype.update=function(e,t){this.system.material.uniforms.elapsedTime.value=t;var n=new THREE.Vector3;n.copy(this.up).applyQuaternion(this.getWorldQuaternion().inverse()),this.system.material.uniforms.up.value=n},t.prototype.updateOne=function(e){this.system.material.uniforms[e].value=this.opts[e]},t.prototype.updateColor=function(e){this.system.material.uniforms[e].value=new THREE.Color(this.opts[e])},t.prototype.randCenter=function(e){return e*(Math.random()-.5)},t}(THREE.Object3D);exports["default"]=Fire}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],8:[function(require,module,exports){"use strict";function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(exports,"__esModule",{value:!0});var _materialUtil=require("./utils/material-util"),Ground=function t(e,a,s){_classCallCheck(this,t),window.fetch("assets/models/snowcap.json").then(function(t){return 200!==t.status?void console.log("Looks like there was a problem. Status Code: "+t.status):void t.json().then(function(t){_materialUtil.convertMaterialsToLambert(t);var o=a.parse(t);o.position.y=s+.1,o.scale.setScalar(.35),e.add(o)})})};exports["default"]=Ground},{"./utils/material-util":16}],9:[function(require,module,exports){(function(global){"use strict";function _interopRequireWildcard(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e["default"]=t,e}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(exports,"__esModule",{value:!0});var _three="undefined"!=typeof window?window.THREE:"undefined"!=typeof global?global.THREE:null,THREE=_interopRequireWildcard(_three),_materialUtil=require("./utils/material-util"),Hand=function(t){function e(r,o){_classCallCheck(this,e);var n=_possibleConstructorReturn(this,t.call(this));return n.objectLoader=r,n.modelSrc=o,n.action={},n.load(),n}return _inherits(e,t),e.prototype.load=function(){var t=this;window.fetch(this.modelSrc).then(function(e){return 200!==e.status?void console.log("Looks like there was a problem. Status Code: "+e.status):void e.json().then(t.handleData.bind(t))})},e.prototype.handleData=function(t){_materialUtil.convertMaterialsToLambert(t);for(var e=0;e<t.materials.length;e++)t.materials[e].skinning=!0;for(var r=this.objectLoader.parse(t),o=0;o<r.children.length;o++)r.children[o].geometry.computeFlatVertexNormals();var n=r.children[0],i=n.geometry.animations;this.mixer=new THREE.AnimationMixer(n);var a=!0,l=!1,s=void 0;try{for(var c,u=i[Symbol.iterator]();!(a=(c=u.next()).done);a=!0){var p=c.value;this.action[p.name]=this.mixer.clipAction(p,n),this.action[p.name].setLoop(THREE.LoopOnce,0),this.action[p.name].clampWhenFinished=!0}}catch(t){l=!0,s=t}finally{try{!a&&u["return"]&&u["return"]()}finally{if(l)throw s}}this.add(r)},e.prototype.update=function(t){this.mixer&&this.mixer.update(t)},e.prototype.grip=function(){this.action.Grip.play()},e.prototype.release=function(){this.action.Grip.stop()},e}(THREE.Object3D);exports["default"]=Hand}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./utils/material-util":16}],10:[function(require){(function(global){"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{"default":e}}function _interopRequireWildcard(e){if(e&&e.__esModule)return e;var r={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(r[n]=e[n]);return r["default"]=e,r}function createScene(){HEIGHT=window.innerHeight,WIDTH=window.innerWidth,scene=new THREE.Scene,scene.fog=new THREE.FogExp2(bgColor,.15);var e=WIDTH/HEIGHT,r=60,n=.05,t=50;camera=new THREE.PerspectiveCamera(r,e,n,t),renderer=new THREE.WebGLRenderer({alpha:!1,antialias:!0}),renderer.setPixelRatio(window.devicePixelRatio),renderer.setClearColor(bgColor,1),renderer.setSize(WIDTH,HEIGHT),renderer.shadowMap.enabled=!0,renderer.shadowMap.type=THREE.PCFSoftShadowMap,container=document.getElementById("world"),container.appendChild(renderer.domElement)}function handleWindowResize(){HEIGHT=window.innerHeight,WIDTH=window.innerWidth,vrEffect.setSize(WIDTH,HEIGHT),renderer.setSize(WIDTH,HEIGHT),camera.aspect=WIDTH/HEIGHT,camera.updateProjectionMatrix()}function createLights(){var e=new THREE.DirectionalLight(16777215,.1);e.position.set(1,2,-1),e.position.normalize(),e.castShadow=!0,e.shadow.camera.left=-10,e.shadow.camera.right=10,e.shadow.camera.top=10,e.shadow.camera.bottom=-10,e.shadow.camera.near=-10,e.shadow.camera.far=10,_query2["default"].debug&&scene.add(new THREE.CameraHelper(e.shadow.camera)),e.shadow.mapSize.width=2048,e.shadow.mapSize.height=2048;var r=new THREE.AmbientLight(16777215,1.3);isNight&&(r.intensity=.1),scene.add(e),scene.add(r)}function createSnowFall(){var e=new _snowfall2["default"](1e5);return e.system.position.set(0,SNOW_HEIGHT,0),scene.add(e.system),e}function createHands(){viveController1&&!function(){var e=new _hand2["default"](objectLoader,"assets/models/hands/handsForOculus/handL.json");if(viveController1.add(e),viveController1.addEventListener("triggerdown",function(){return e.grip()}),viveController1.addEventListener("triggerup",function(){return e.release()}),updateObjects.push(e),isNight){var r=new _torch2["default"];r.position.z=.04,r.position.y=-.02,r.rotation.z=-Math.PI/2,r.rotation.y=Math.PI/4,e.add(r),updateObjects.push(r),e.rotation.z=Math.PI/4}}(),viveController2&&!function(){var e=new _hand2["default"](objectLoader,"assets/models/hands/handsForOculus/handR.json");viveController2.add(e),viveController2.addEventListener("triggerdown",function(){return e.grip()}),viveController2.addEventListener("triggerup",function(){return e.release()}),updateObjects.push(e)}()}function loop(){var e=clock.getDelta(),r=clock.getElapsedTime();viveController1&&viveController1.update(),viveController2&&viveController2.update();var n=!0,t=!1,o=void 0;try{for(var i,a=updateObjects[Symbol.iterator]();!(n=(i=a.next()).done);n=!0){var l=i.value;l.update(e,r)}}catch(e){t=!0,o=e}finally{try{!n&&a["return"]&&a["return"]()}finally{if(t)throw o}}vrControls.update(e),vrManager.render(scene,camera,e),vrDisplay.requestAnimationFrame(loop)}function showControllerGuideRays(){var e=new THREE.Geometry;e.vertices.push(new THREE.Vector3(0,0,0)),e.vertices.push(new THREE.Vector3(0,0,-1));var r=new THREE.Line(e);r.name="line",r.scale.z=5,viveController1.add(r.clone()),viveController2.add(r.clone())}function initViveControllers(){return navigator.getGamepads?(viveController1=new THREE.ViveController(0),viveController1.standingMatrix=vrControls.getStandingMatrix(),scene.add(viveController1),viveController2=new THREE.ViveController(1),viveController2.standingMatrix=vrControls.getStandingMatrix(),scene.add(viveController2),void(_query2["default"].debug&&showControllerGuideRays())):void console.warn("GAMEPAD API not enabled?")}function initVR(){vrControls=new THREE.VRControls(camera),vrControls.standing=!0,vrEffect=new THREE.VREffect(renderer),vrEffect.setSize(window.innerWidth,window.innerHeight);var e={hideButton:!1,isUndistorted:!1};vrManager=new _webvrBoilerplate2["default"](renderer,vrEffect,e),setupStage(),initViveControllers(),window.addEventListener("resize",handleWindowResize,!1),window.addEventListener("vrdisplaypresentchange",handleWindowResize,!0)}function init(){createScene(),initVR(),createLights(),ground=new _ground2["default"](scene,objectLoader,SNOW_HEIGHT),treeline=new _treeline2["default"](scene),createHands(),updateObjects.push(createSnowFall()),updateObjects.push(new _moose2["default"](scene,jsonLoader))}function setupStage(){navigator.getVRDisplays().then(function(e){e.length>0&&(vrDisplay=e[0],vrDisplay.stageParameters&&setStageDimensions(vrDisplay.stageParameters),vrDisplay.requestAnimationFrame(loop))})}function setStageDimensions(){}require("whatwg-fetch");var _three="undefined"!=typeof window?window.THREE:"undefined"!=typeof global?global.THREE:null,THREE=_interopRequireWildcard(_three),_query=require("./utils/query"),_query2=_interopRequireDefault(_query),_ground=require("./ground"),_ground2=_interopRequireDefault(_ground),_treeline=require("./treeline"),_treeline2=_interopRequireDefault(_treeline),_moose=require("./moose"),_moose2=_interopRequireDefault(_moose),_snowfall=require("./snowfall"),_snowfall2=_interopRequireDefault(_snowfall),_torch=require("./torch"),_torch2=_interopRequireDefault(_torch),_hand=require("./hand"),_hand2=_interopRequireDefault(_hand),_snowpuff=require("./snowpuff"),_OBJLoader2=(_interopRequireDefault(_snowpuff),require("OBJLoader")),_VRControls2=(_interopRequireDefault(_OBJLoader2),require("VRControls")),_VREffect2=(_interopRequireDefault(_VRControls2),require("VREffect")),_ViveController2=(_interopRequireDefault(_VREffect2),require("ViveController")),_webvrBoilerplate=(_interopRequireDefault(_ViveController2),require("webvr-boilerplate")),_webvrBoilerplate2=_interopRequireDefault(_webvrBoilerplate),SNOW_HEIGHT=.5,clock=new THREE.Clock,jsonLoader=new THREE.JSONLoader,objectLoader=new THREE.ObjectLoader,updateObjects=[],scene=void 0,camera=void 0,HEIGHT=void 0,WIDTH=void 0,renderer=void 0,container=void 0,vrControls=void 0,vrEffect=void 0,vrManager=void 0,vrDisplay=void 0,viveController1=void 0,viveController2=void 0,ground=void 0,treeline=void 0,isNight=_query2["default"].isNight,bgColor=isNight?1118498:13028607;window.addEventListener("load",init,!1)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./ground":8,"./hand":9,"./moose":11,"./snowfall":12,"./snowpuff":13,"./torch":14,"./treeline":15,"./utils/query":17,OBJLoader:3,VRControls:1,VREffect:2,ViveController:4,"webvr-boilerplate":5,"whatwg-fetch":6}],11:[function(require,module,exports){(function(global){"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{"default":e}}function _interopRequireWildcard(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t["default"]=e,t}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(exports,"__esModule",{value:!0});var _three="undefined"!=typeof window?window.THREE:"undefined"!=typeof global?global.THREE:null,THREE=_interopRequireWildcard(_three),_snowpuff=require("./snowpuff"),_snowpuff2=_interopRequireDefault(_snowpuff),_randomUtil=require("./utils/random-util"),MIN_DISTANCE=.5,MAX_DISTANCE=7,Moose=function(){function e(t,o){_classCallCheck(this,e),this.scene=t,this.snowpuffs=[],this.loader=o,this.mooseStart=-20,this.mooseDistance=0,this.mooseFirstTime=!0,this.mooseAngle=Math.PI,this.mooseWrapper=void 0,this.moose=void 0,this.mesh=void 0,this.mixer=void 0,this.animationClip=void 0,this.animationAction=void 0,this.load()}return e.prototype.load=function(){var e=this;this.loader.load("assets/models/moose_life.js",function(t){e.mesh=new THREE.Mesh(t,new THREE.MeshLambertMaterial({vertexColors:THREE.FaceColors,morphTargets:!0})),e.mesh.scale.setScalar(.01),e.mesh.castShadow=!0,e.moose=new THREE.Object3D,e.moose.add(e.mesh),e.mooseWrapper=new THREE.Object3D,e.mooseWrapper.add(e.moose),e.scene.add(e.mooseWrapper),e.initAnimation(t),e.initSnowEffect()})},e.prototype.initAnimation=function(e){this.mixer=new THREE.AnimationMixer(this.mesh),this.animationClip=THREE.AnimationClip.CreateFromMorphTargetSequence("gallop",e.morphTargets,60),this.animationAction=this.mixer.clipAction(this.animationClip).setDuration(1).play()},e.prototype.initSnowEffect=function(){var e=new _snowpuff2["default"](this.scene);e.system.position.set(0,0,0),this.moose.add(e.system),this.snowpuffs.push(e);var t=new _snowpuff2["default"](this.scene,.15);t.system.position.set(0,0,-1.5),this.moose.add(t.system),this.snowpuffs.push(t)},e.prototype.update=function(e,t){if(this.mixer){this.mooseDistance+=3*e;var o=this.mooseStart+this.mooseDistance;if(this.mooseFirstTime||o>Math.abs(this.mooseStart)){this.mooseFirstTime=!1,this.mooseAngle+=Math.PI+_randomUtil.randomBetween(-Math.PI/8,Math.PI/8),this.mooseDistance=0,this.mooseWrapper.rotation.y=this.mooseAngle;var i=_randomUtil.randomBetween(MIN_DISTANCE,MAX_DISTANCE);this.moose.position.x=_randomUtil.randomPick([i,-i])}this.moose.position.z=o,this.mixer.update(e);var s=!0,n=!1,a=void 0;try{for(var r,h=this.snowpuffs[Symbol.iterator]();!(s=(r=h.next()).done);s=!0){var m=r.value;m.update(e,t)}}catch(e){n=!0,a=e}finally{try{!s&&h["return"]&&h["return"]()}finally{if(n)throw a}}}},e}();exports["default"]=Moose}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./snowpuff":13,"./utils/random-util":18}],12:[function(require,module,exports){(function(global){"use strict";function _interopRequireWildcard(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t["default"]=e,t}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(exports,"__esModule",{value:!0});var _three="undefined"!=typeof window?window.THREE:"undefined"!=typeof global?global.THREE:null,THREE=_interopRequireWildcard(_three),PARTICLE_SIZE=.006,Snowfall=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1e3,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10,n=this,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:10,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:10;_classCallCheck(this,e),this.numParticles=t,this.height=i,this.width=o,this.depth=r;var s=new THREE.TextureLoader;s.load("assets/textures/snowflake.png",function(e){n.texture=e,n.system.material.uniforms.texture.value=e}),this._size=-1,this.setParticleSize(),window.addEventListener("resize",function(){return n.setParticleSize()}),this.init()}return e.prototype.setParticleSize=function(){this._size=window.innerHeight*PARTICLE_SIZE*window.devicePixelRatio},e.prototype.getParticleSize=function(){return this._size},e.prototype.init=function(){for(var e=new THREE.BufferGeometry,t=new THREE.ShaderMaterial({uniforms:{color:{type:"c",value:new THREE.Color(16777215)},height:{type:"f",value:this.height},speedV:{type:"f",value:.4},speedH:{type:"f",value:2},elapsedTime:{type:"f",value:0},radius:{type:"f",value:.02},scale:{type:"f",value:2},size:{type:"f",value:this._size},opacity:{type:"f",value:.1},texture:{type:"t",value:null}},vertexShader:"\n        uniform float height;\n        uniform float elapsedTime;\n        uniform float speedV;\n        uniform float speedH;\n        uniform float radius;\n        uniform float scale;\n        uniform float size;\n        attribute float uniqueness;\n        void main() {\n          vec3 pos = position;\n          pos.x += cos((elapsedTime - position.z - uniqueness) * speedH) * radius;\n          pos.y = mod(position.y - elapsedTime * speedV, height);\n          pos.z += sin((elapsedTime - position.x - uniqueness) * speedH) * radius;\n          vec4 mvPosition = modelViewMatrix * vec4( pos, 1.0 );\n          gl_PointSize = size * ( scale / length( mvPosition.xyz ) );\n          gl_Position = projectionMatrix * mvPosition;\n        }\n      ",fragmentShader:"\n        uniform vec3 color;\n        uniform float opacity;\n        uniform sampler2D texture;\n        void main() {\n          vec4 texColor = texture2D( texture, gl_PointCoord );\n          gl_FragColor = texColor * vec4( color, opacity );\n        }\n      ",transparent:!0,depthTest:!1,blending:THREE.AdditiveBlending}),i=new Float32Array(3*this.numParticles),n=new Float32Array(this.numParticles),o=0;o<i.length;o+=3)i[o]=this.randCenter(this.width),i[o+1]=Math.random()*this.height,i[o+2]=this.randCenter(this.depth);for(var r=0;r<this.numParticles;r++)n[r]=Math.random();e.addAttribute("position",new THREE.BufferAttribute(i,3)),e.addAttribute("uniqueness",new THREE.BufferAttribute(n,1)),e.computeBoundingSphere(),this.system=new THREE.Points(e,t),this.system.renderOrder=1,this.system.sortParticles=!0},e.prototype.update=function(e,t){this.system.material.uniforms.elapsedTime.value=t,this.system.material.uniforms.size.value=this.getParticleSize()},e.prototype.randCenter=function(e){return e*(Math.random()-.5)},e}();exports["default"]=Snowfall}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],13:[function(require,module,exports){(function(global){"use strict";function _interopRequireWildcard(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t["default"]=e,t}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(exports,"__esModule",{value:!0});var _three="undefined"!=typeof window?window.THREE:"undefined"!=typeof global?global.THREE:null,THREE=_interopRequireWildcard(_three),Snowpuff=function(){function e(t){var n=this,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;_classCallCheck(this,e),this.scene=t,this.numParticles=2e4,this.maxHeight=.5,this.minHeight=.2,this.offset=o;var i=new THREE.TextureLoader;i.load("assets/textures/snowflake.png",function(e){n.texture=e,n.system.material.uniforms.texture.value=e}),this.init()}return e.prototype.init=function(){for(var e=new THREE.BufferGeometry,t=new THREE.ShaderMaterial({uniforms:{color:{type:"c",value:new THREE.Color(16777215)},speed:{type:"f",value:4},elapsedTime:{type:"f",value:0},scale:{type:"f",value:4},size:{type:"f",value:8},opacity:{type:"f",value:.7},fogColor:{type:"c",value:this.scene.fog.color},fogNear:{type:"f",value:this.scene.fog.near},fogFar:{type:"f",value:this.scene.fog.far},fogDensity:{type:"f",value:this.scene.fog.density},texture:{type:"t",value:null}},transparent:!0,depthWrite:!1,fragmentShader:"\n        varying vec2 vUv;\n\n        uniform vec3 color;\n        uniform float opacity;\n        uniform sampler2D texture;\n\n        "+THREE.ShaderChunk.common+"\n        "+THREE.ShaderChunk.fog_pars_fragment+"\n        void main() {\n          vec4 texColor = texture2D( texture, gl_PointCoord );\n          gl_FragColor = texColor * vec4( color, opacity );\n          "+THREE.ShaderChunk.fog_fragment+"\n\n          // addative blending bleeds through fog so let's reduce even more\n          // gl_FragColor.w *= mix(1.0, 0.05, fogFactor);\n        }\n      ",fog:!0,vertexShader:"\n        uniform float elapsedTime;\n        uniform float speed;\n        uniform float scale;\n        uniform float size;\n        attribute vec3 velocity;\n        // attribute float uniqueness;\n\n        varying vec2 vUv;\n        varying vec3 vPosition;\n        void main( void ) {\n          vUv = uv;\n          vPosition = position;\n\n          // make time loop\n          float time = mod(elapsedTime, 1.0);\n\n          vec3 gravity = vec3(0, 1, 0) * time * speed * 0.4;\n          vec3 direction = (velocity + vec3(0, 0, -0.5)) * time * speed * 1.0;\n          vec3 pos = position + direction + pow(gravity, vec3(2.0)) * -1.0;\n\n          vec4 mvPosition = modelViewMatrix * vec4( pos, 1.0 );\n          gl_PointSize = size * ( scale / length( mvPosition.xyz ) );\n          gl_Position = projectionMatrix * modelViewMatrix * vec4( pos, 1.0 );\n        }\n      "}),n=new Float32Array(3*this.numParticles),o=0;o<n.length;o+=3)n[o]=0;for(var i=new Float32Array(this.numParticles),r=new Float32Array(3*this.numParticles),a=0;a<r.length;a+=3){var s=Math.random()*this.maxHeight+this.minHeight,l=this.randCenter(.66*Math.PI),u=this.randCenter(Math.PI),f=THREE.Spherical(s,l,u),c=new THREE.Vector3;

c.setFromSpherical(f),r[a]=c.x,r[a+1]=c.y,r[a+2]=c.z}for(var v=0;v<this.numParticles;v++)i[v]=Math.random();e.addAttribute("position",new THREE.BufferAttribute(n,3)),e.addAttribute("velocity",new THREE.BufferAttribute(r,3)),e.addAttribute("uniqueness",new THREE.BufferAttribute(i,1)),e.computeBoundingSphere(),this.system=new THREE.Points(e,t)},e.prototype.update=function(e,t){this.system.material.uniforms.elapsedTime.value=t+this.offset},e.prototype.randCenter=function(e){return e*(Math.random()-.5)},e}();exports["default"]=Snowpuff}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],14:[function(require,module,exports){(function(global){"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{"default":e}}function _interopRequireWildcard(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t["default"]=e,t}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(exports,"__esModule",{value:!0});var _three="undefined"!=typeof window?window.THREE:"undefined"!=typeof global?global.THREE:null,THREE=_interopRequireWildcard(_three),_fire=require("./fire"),_fire2=_interopRequireDefault(_fire),Torch=function(e){function t(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:16764057,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;_classCallCheck(this,t);var o=_possibleConstructorReturn(this,e.call(this));o.color=r,o.intensity=i,o.light=new THREE.PointLight(r,i,10,1),o.light.castShadow=!0,o.light.shadow.camera.near=1,o.light.shadow.camera.far=30,o.light.shadow.bias=.01,o.add(o.light);var n=new THREE.CylinderGeometry(.03,.01,.5,16),l=new THREE.MeshBasicMaterial({color:2228224}),a=new THREE.Mesh(n,l);return o.add(a),o.fire=new _fire2["default"],o.fire.init(),o.light.position.y=.255,o.fire.position.y=.255,o.add(o.fire),o}return _inherits(t,e),t.prototype.update=function(e,t){this.fire.update(e,t)},t.prototype.on=function(){this.light.intensity=this.intensity,this.sphere.material.color.setHex(this.color)},t.prototype.off=function(){this.light.intensity=0,this.sphere.material.color.setHex(0)},t}(THREE.Object3D);exports["default"]=Torch}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./fire":7}],15:[function(require,module,exports){(function(global){"use strict";function _interopRequireWildcard(e){if(e&&e.__esModule)return e;var r={};if(null!=e)for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(r[a]=e[a]);return r["default"]=e,r}function _classCallCheck(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(exports,"__esModule",{value:!0});var _three="undefined"!=typeof window?window.THREE:"undefined"!=typeof global?global.THREE:null,THREE=_interopRequireWildcard(_three),_randomUtil=require("./utils/random-util"),Ground=function e(r){_classCallCheck(this,e);var a=new THREE.JSONLoader;a.load("assets/models/treeGenericLower.js",function(e){var a=new THREE.Mesh(e,new THREE.MeshLambertMaterial({vertexColors:THREE.FaceColors,transparent:!0,opacity:.8}));a.scale.setScalar(.01),a.castShadow=!0;for(var n=0;40>n;n++){var o=_randomUtil.randomBetween(6,11)*_randomUtil.randomPick([-1,1]),t=_randomUtil.randomBetween(6,11)*_randomUtil.randomPick([-1,1]),l=a.clone();l.position.set(o,-.5,t),r.add(l)}})};exports["default"]=Ground}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./utils/random-util":18}],16:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});exports.convertMaterialsToLambert=function(e){function t(e){e.type="MeshLambertMaterial",delete e.specular,e.shininess=0}for(var a=0;a<e.materials.length;a++){var r=e.materials[a];if("MultiMaterial"===r.type)for(var s=0;s<r.materials.length;s++)t(r.materials[s]);else t(e.materials[a])}}},{}],17:[function(require,module){"use strict";function qs(){var n={},o=window.location.href.substring(window.location.href.indexOf("?")+1,window.location.href.length);-1!==o.indexOf("#")&&(o=o.substring(0,o.indexOf("#")));for(var e=o.split("&"),t=0;t<e.length;t++){var i=e[t].split("="),r=decodeURIComponent(i[0]),d=decodeURIComponent(i[1]);n[r]=d||!0}return n}module.exports=qs()},{}],18:[function(require,module,exports){"use strict";function randomPick(e){return e[Math.floor(Math.random()*e.length)]}function randomBetween(e,r){return Math.floor(Math.random()*r)+e}function randomCenter(e){return e*(Math.random()-.5)}Object.defineProperty(exports,"__esModule",{value:!0}),exports.randomPick=randomPick,exports.randomBetween=randomBetween,exports.randomCenter=randomCenter},{}]},{},[10]);